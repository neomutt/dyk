---
layout: concertina
title: Multi-Account Set-Up
description: 
date: 2020-10-07
---

# {{ page.title }}

{:.subtitle}
{{ page.description }}
{% include dyk-links.html %}

Here is one method of switching between IMAP accounts. Requires _Safe user/pass
storage with Lastpass_. It is quite involved to avoid connecting to the same
IMAP server twice during account switch.

**~/.config/neomutt/imap/imap.cfg**

```

# fast-switching between accounts
# use full-paths, as these are going to be executed at run-time,
# where there's no concept of a current source file directory.
macro index <F6"<enter-command>source ~/.config/neomutt/imap/hotmail.cfg<enter><sync-mailbox>"
macro index <F7"<enter-command>source ~/.config/neomutt/imap/gmail.cfg<enter><sync-mailbox>"
macro index <F8"<enter-command>source ~/.config/neomutt/imap/fastmail.cfg<enter><sync-mailbox>"

# common configuration valid for all accounts
set imap_check_subscribed = yes
set imap_authenticators = plain
set move = no

# guard to avoid double-loading on startup
set my_imap_done = true

# my default account
source ./gmail.cfg

# vim: set ft=neomuttrc:
```

**~/.config/neomutt/imap/gmail.cfg**

```
source ./pre.cfg

set imap_pass = "$my_gmail_pass"

set my_folder = imaps://$my_gmail_user@imap.gmail.com:993
set my_spool  = +Inbox
set my_junk   = +[Gmail]/Spam
set my_trash  = +[Gmail]/Trash
set my_drafts = +[Gmail]/Drafts
set my_record = "+[Gmail]/Sent Mail"

set smtp_url  = smtps://$my_gmail_user@smtp.gmail.com
set smtp_pass = "$my_gmail_pass"
set smtp_authenticators = plain

ifdef my_imap_done "push ':source ~/.config/neomutt/imap/post2.cfg'<enter>"
ifdef my_imap_done "push ':source ~/.config/neomutt/imap/post1.cfg'<enter>"

# vim: set ft=neomuttrc:
```

**~/.config/neomutt/imap/fastmail.cfg**

```
source ./pre.cfg

set imap_pass = "$my_fastmail_pass"

set my_folder = imaps://$my_fastmail_user@imap.fastmail.com/
set my_spool  = +Inbox
set my_junk   = +Spam
set my_trash  = +Trash
set my_drafts = +Drafts
set my_record = +Sent

set smtp_url  = smtps://$my_fastmail_user@smtp.fastmail.com
set smtp_pass = "$my_fastmail_pass"
set smtp_authenticators = plain

ifdef my_imap_done "push ':source ~/.config/neomutt/imap/post2.cfg'<enter>"
ifdef my_imap_done "push ':source ~/.config/neomutt/imap/post1.cfg'<enter>"

# vim: set ft=neomuttrc:
```

**~/.config/neomutt/imap/hotmail.cfg**

```
source ./pre.cfg

set imap_pass = "$my_hotmail_pass"

set my_folder = imaps://$my_hotmail_user@outlook.office365.com
set my_spool  = +Inbox
set my_junk   = +Junk
set my_trash  = +Deleted
set my_drafts = +Drafts
set my_record = +Sent

set smtp_url  = smtp://$my_hotmail_user@smtp.office365.com:587
set smtp_pass = "$my_hotmail_pass"
set smtp_authenticators = login

ifdef my_imap_done "push ':source ~/.config/neomutt/imap/post2.cfg'<enter>"
ifdef my_imap_done "push ':source ~/.config/neomutt/imap/post1.cfg'<enter>"

# vim: set ft=neomuttrc:
```

And so on for other IMAP accounts


**~/.config/neomutt/imap/pre.cfg**
```
# cleanup 
unhook folder-hook
unmailboxes *

unset my_folder my_spool my_junk my_trash my_drafts my_record
unset imap_pass smtp_url smtp_pass smtp_authenticators

# vim: set ft=neomuttrc:
```

**~/.config/neomutt/imap/post1.cfg**

```
# Open the sourced account's Inbox
push <change-folder>$my_folder<enter>
```

**~/.config/neomutt/imap/post2.cfg**

```
# Actually set NeoMutt variables
set folder    = $my_folder
set spoolfile = $my_spool
set trash     = $my_trash
set postponed = $my_drafts
set record    = $my_record

folder-hook . set trash = \$my_trash
folder-hook "$my_junk" unset trash
folder-hook "$my_trash" unset trash

# Adjust macros for navigating well-known folders
macro index,pager gd <change-folder>$my_drafts<enter>
macro index,pager gi <change-folder>$my_folder<enter>
macro index,pager gj <change-folder>$my_junk<enter>
macro index,pager gs <change-folder>$my_record<enter>
macro index,pager gt <change-folder>$my_trash<enter>
macro browser gd <exit><change-folder>$my_drafts<enter>
macro browser gi <exit><change-folder>$my_folder<enter>
macro browser gj <exit><change-folder>$my_junk<enter>
macro browser gs <exit><change-folder>$my_record<enter>
macro browser gt <exit><change-folder>$my_trash<enter>
```

Credit: [Pietro Cerutti](https://github.com/gahr)

